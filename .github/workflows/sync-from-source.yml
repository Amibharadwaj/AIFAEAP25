name: Sync from Source Repository

on:
  schedule:
    # Run daily at 2 AM UTC (7:30 AM IST)
    - cron: '0 2 * * *'
  # Manual trigger option
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
      - name: Checkout this repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Add remote for source repo
        run: |
          git remote add source https://github.com/neerajverma101/finance-coach-ai.git || true
          git remote set-url source https://github.com/neerajverma101/finance-coach-ai.git

      - name: Fetch from source
        run: git fetch source main --force

      - name: Merge source changes
        run: |
          git config user.name "Sync Bot"
          git config user.email "noreply@github.com"
          git merge source/main --no-edit --allow-unrelated-histories || echo "Already up to date or merge conflict"

      - name: Push changes
        run: git push origin main
        continue-on-error: true
